<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
 <title>Ladies and gentlemen!</title>
 <meta charset="utf-8" />
 <link rel="stylesheet" href="style.css" />
 <script src="jquery.js" ></script>
 <script src="jquery.tagcanvas.min.js" type="text/javascript"></script>
 <script type="text/javascript">
  var gradient = {
    0:    '#f00', // red
    0.33: '#ff0', // yellow
    0.66: '#0f0', // green
    1:    '#00f'  // blue
  };
 
  window.onload = function() {
    TagCanvas.textColour = '#000000';
    TagCanvas.textFont = 'Calibri, Arial Black, sans-serif';
    TagCanvas.outlineColour = '#5B9EB8';
    TagCanvas.outlineThickness = 5;
    TagCanvas.weightGradient = gradient;
    TagCanvas.initial = [0.1,-0.1];
    TagCanvas.zoom = 0.9;
    TagCanvas.maxSpeed = 0.03;
    try {
      TagCanvas.Start('myCanvas');
    } catch(e) {
      // something went wrong, hide the canvas container
      document.getElementById('canvasContainer').style.display = 'none';
    }
  };
  
  function idSort(a,b) { return a.id - b.id }
  
  function sortByKey(obj,key) {
    return obj.sort(function(a, b) {
      return b[key] - a[key];
    });
  }
  
  $(document).ready(function(){
    var canvas = document.getElementById("myCanvas");
    var context = canvas.getContext("2d");
    var twats = new Array();
    var SHOW = 100;
    
    $("#pc1").click(function() {redraw('pc1')});
    $("#leisure").click(function() {redraw('leisure')});
    $("#science").click(function() {redraw('science')});
    $("#tech").click(function() {redraw('tech')});
    $("#health").click(function() {redraw('health')});
    $("#sports").click(function() {redraw('sports')});
    $("#arts").click(function() {redraw('arts')});
    $("#business").click(function() {redraw('business')});

    function redraw(key) {
      sortJSON(key);
      draw();
    }
    
    function draw() {
      context.clearRect (0, 0, canvas.width, canvas.height);
      if( ! $('#myCanvas').tagcanvas({
        outlineThickness : 1,
        depth : 0.75,
        weight : true,
        weightFrom : 'data-weight',
        weightMode : 'size',
      })) {
        // TagCanvas failed to load
        $('#canvasContainer').hide();
      }
    }    
    
    function sortJSON(key) {
      twats = sortByKey(twats, key);
      
      var MIN = 100;
      var MAX = 0;
      
      for( var i=0; i<SHOW; i++ ) {
        var me = twats[i];
        if (me[key] < MIN) MIN = me[key];
        if (me[key] > MAX) MAX = me[key];
      }
      
      var best = twats[0];
      console.log('Best: ' + best.screen_name + ' (' + best[key] + ') min: ' + MIN + '; max: ' + MAX);    
      
      document.getElementById('twatlist').innerHTML = '';
      for( var i=0; i<SHOW; i++ ) {
        var me = twats[i];
        var weight = ((me[key]-MIN)*20/(MAX-MIN))+10;
        console.log(key + ': ' + me.screen_name + '=' + me[key] + ' (' + weight + ')');
        document.getElementById('twatlist').innerHTML += '<li><a href="http://twitter.com/' + me.screen_name + '" data-weight="' +  weight + '">' + me.screen_name + '</a></li>' + "\n";
      }
    }
    
    function readJSON() {
      $.ajax({
        url: "data/concise.json",
        dataType:"text",
        error: function(request,error) {
          console.log(arguments);
          alert ( " Can't do because: " + error );
        }
      }).done(function(data){
        
        lines = data.split('\n');
        for( var i in lines ) {
          if (lines[i] != "") {
            twats[i] = $.parseJSON(lines[i]);
          }
        }
        
        sortJSON('pc1');
        
        draw();
        
      });
    }
    readJSON();
    
  });
 </script>
</head>

<body>
<div id='jjcontent'>

<div id="canvasContainer">
 <canvas width="800" height="800" id="myCanvas">
  <ul id='twatlist'>
  </ul>
 </canvas>
</div>

<div id='buttons'>
  <button id='pc1'>PC1</button>
  <button id='leisure'>Leisure</button>
  <button id='science'>Science</button>
  <button id='tech'>Technology</button>
  <button id='health'>Health</button>
  <button id='sports'>Sports</button>
  <button id='arts'>Arts</button>
  <button id='business'>Business</button>
</div>
  
</div>

</body>
</html>
